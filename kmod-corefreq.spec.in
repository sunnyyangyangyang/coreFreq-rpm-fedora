%global debug_package %{nil}

Name:           kmod-corefreq
Version:        @VERSION@
Release:        @RELEASE@%{?dist}
Summary:        CoreFreq kernel module
License:        GPL-2.0-only

# This defines the virtual package for the kernel.
Provides:       kernel-modules-for-kernel = %(uname -r)
# The user-space tools depend on this name.
Provides:       kmod-corefreq = @VERSION@

# The source tarball is local to the build now.
Source0:        CoreFreq-@VERSION@.tar.gz

%prep
# Unpack the source tarball. The -n flag is critical.
%autosetup -n CoreFreq-@VERSION@

%build
# Build the kernel module from within the unpacked source directory.
make -C . KERNELDIR=%{_usrsrc}/kernels/%{kver} corefreqk.ko

%install
# Install the built .ko file to the final destination.
install -D -m 0755 build/corefreqk.ko %{buildroot}%{kmodinstdir}/corefreqk.ko

%files
# This macro finds and owns the .ko file.
%kmod_files